import{al as R,j,$ as v,E as O,a0 as I,am as x,R as M,ag as N,U as T,an as P,G as L}from"#entry";import{i as U}from"./BJ2ClxiI.js";function $(e,n){if(typeof e!="string")throw new TypeError("argument str must be a string");const t={},o=n||{},a=o.decode||F;let i=0;for(;i<e.length;){const r=e.indexOf("=",i);if(r===-1)break;let s=e.indexOf(";",i);if(s===-1)s=e.length;else if(s<r){i=e.lastIndexOf(";",r-1)+1;continue}const u=e.slice(i,r).trim();if(o?.filter&&!o?.filter(u)){i=s+1;continue}if(t[u]===void 0){let c=e.slice(r+1,s).trim();c.codePointAt(0)===34&&(c=c.slice(1,-1)),t[u]=B(c,a)}i=s+1}return t}function F(e){return e.includes("%")?decodeURIComponent(e):e}function B(e,n){try{return n(e)}catch{return e}}const w=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function E(e,n,t){const o=t||{},a=o.encode||encodeURIComponent;if(typeof a!="function")throw new TypeError("option encode is invalid");if(!w.test(e))throw new TypeError("argument name is invalid");const i=a(n);if(i&&!w.test(i))throw new TypeError("argument val is invalid");let r=e+"="+i;if(o.maxAge!==void 0&&o.maxAge!==null){const s=o.maxAge-0;if(Number.isNaN(s)||!Number.isFinite(s))throw new TypeError("option maxAge is invalid");r+="; Max-Age="+Math.floor(s)}if(o.domain){if(!w.test(o.domain))throw new TypeError("option domain is invalid");r+="; Domain="+o.domain}if(o.path){if(!w.test(o.path))throw new TypeError("option path is invalid");r+="; Path="+o.path}if(o.expires){if(!H(o.expires)||Number.isNaN(o.expires.valueOf()))throw new TypeError("option expires is invalid");r+="; Expires="+o.expires.toUTCString()}if(o.httpOnly&&(r+="; HttpOnly"),o.secure&&(r+="; Secure"),o.priority)switch(typeof o.priority=="string"?o.priority.toLowerCase():o.priority){case"low":{r+="; Priority=Low";break}case"medium":{r+="; Priority=Medium";break}case"high":{r+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(o.sameSite)switch(typeof o.sameSite=="string"?o.sameSite.toLowerCase():o.sameSite){case!0:{r+="; SameSite=Strict";break}case"lax":{r+="; SameSite=Lax";break}case"strict":{r+="; SameSite=Strict";break}case"none":{r+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return o.partitioned&&(r+="; Partitioned"),r}function H(e){return Object.prototype.toString.call(e)==="[object Date]"||e instanceof Date}function h(e){if(typeof e!="object")return e;var n,t,o=Object.prototype.toString.call(e);if(o==="[object Object]"){if(e.constructor!==Object&&typeof e.constructor=="function"){t=new e.constructor;for(n in e)e.hasOwnProperty(n)&&t[n]!==e[n]&&(t[n]=h(e[n]))}else{t={};for(n in e)n==="__proto__"?Object.defineProperty(t,n,{value:h(e[n]),configurable:!0,enumerable:!0,writable:!0}):t[n]=h(e[n])}return t}if(o==="[object Array]"){for(n=e.length,t=Array(n);n--;)t[n]=h(e[n]);return t}return o==="[object Set]"?(t=new Set,e.forEach(function(a){t.add(h(a))}),t):o==="[object Map]"?(t=new Map,e.forEach(function(a,i){t.set(h(i),h(a))}),t):o==="[object Date]"?new Date(+e):o==="[object RegExp]"?(t=new RegExp(e.source,e.flags),t.lastIndex=e.lastIndex,t):o==="[object DataView]"?new e.constructor(h(e.buffer)):o==="[object ArrayBuffer]"?e.slice(0):o.slice(-6)==="Array]"?new e.constructor(e):e}const q={path:"/",watch:!0,decode:e=>R(decodeURIComponent(e)),encode:e=>encodeURIComponent(typeof e=="string"?e:JSON.stringify(e))},y=globalThis.cookieStore;function J(e,n){const t={...q,...n};t.filter??=c=>c===e;const o=C(t)||{};let a;t.maxAge!==void 0?a=t.maxAge*1e3:t.expires&&(a=t.expires.getTime()-Date.now());const i=a!==void 0&&a<=0,r=i||o[e]===void 0||o[e]===null,s=h(i?void 0:o[e]??t.default?.()),u=a&&!i?V(s,a,t.watch&&t.watch!=="shallow"):j(s);{let c=null;try{!y&&typeof BroadcastChannel<"u"&&(c=new BroadcastChannel(`nuxt:cookies:${e}`))}catch{}const f=(l=!1)=>{!l&&(t.readonly||U(u.value,o[e]))||(G(e,u.value,t),o[e]=h(u.value),c?.postMessage({value:t.encode(u.value)}))},d=l=>{const g=l.refresh?C(t)?.[e]:t.decode(l.value);p=!0,u.value=g,o[e]=h(g),M(()=>{p=!1})};let p=!1;const m=!!I();if(m&&v(()=>{p=!0,f(),c?.close()}),y){const l=g=>{const b=g.changed.find(k=>k.name===e),D=g.deleted.find(k=>k.name===e);b&&d({value:b.value}),D&&d({value:null})};y.addEventListener("change",l),m&&v(()=>y.removeEventListener("change",l))}else c&&(c.onmessage=({data:l})=>d(l));t.watch&&O(u,()=>{p||f()},{deep:t.watch!=="shallow"}),r&&f(r)}return u}function C(e={}){return $(document.cookie,e)}function z(e,n,t={}){return n==null?E(e,n,{...t,maxAge:-1}):E(e,n,t)}function G(e,n,t={}){document.cookie=z(e,n,t)}const A=2147483647;function V(e,n,t){let o,a,i=0;const r=t?j(e):{value:e};return I()&&v(()=>{a?.(),clearTimeout(o)}),x((s,u)=>{t&&(a=O(r,u));function c(){i=0,clearTimeout(o);const f=n-i,d=f<A?f:A;o=setTimeout(()=>{if(i+=d,i<n)return c();r.value=void 0,u()},d)}return{get(){return s(),r.value},set(f){c(),r.value=f,u()}}})}function X(){try{const e=ee?.()||null;if(e&&e.token)return e.token}catch{}try{return localStorage.getItem("token")||""}catch{return""}}const Y=()=>{const{public:e}=N(),n=(i={})=>{const r=X(),s={};return r&&(s.Authorization=`Bearer ${r}`),{Accept:"application/json",...s,...i}},t=i=>{try{const{$awn:r}=T();r?.success(i||"Success")}catch{}},o=(i,r)=>{const s=i?.response||{},u=s.status||i?.status,c=s._data||i?.data||i,f=s.statusText||i?.statusText,d=c?.message||c?.error||"",p=r||(u?`${f||"Error"} (${u})${d?": "+d:""}`:d||"Something went wrong");try{const{$awn:m}=T();m?.alert(p)}catch{}},a=async(i,r,s,u={})=>{const{toast:c={showSuccess:!1,showError:!0,successMessage:""},headers:f,query:d}=u,p=typeof FormData<"u"&&s instanceof FormData,m=s&&!p&&i!=="GET"?typeof s=="string"?s:JSON.stringify(s):s;try{const l=await $fetch(r,{baseURL:e.apiBaseUrl,method:i,body:m,headers:n(p?f:{"Content-Type":"application/json",...f}),query:d,retry:0,onRequest({options:g}){g.headers=g.headers||{}}});return c?.showSuccess&&t(c.successMessage||"Success"),l}catch(l){throw c?.showError!==!1&&o(l,c?.errorMessage),l}};return{get:(i,r)=>a("GET",i,void 0,r),post:(i,r,s)=>a("POST",i,r,s),put:(i,r,s)=>a("PUT",i,r,s),patch:(i,r,s)=>a("PATCH",i,r,s),delete:(i,r)=>a("DELETE",i,void 0,r),request:a}},S=Y();function K(e="",n=""){try{localStorage.setItem("token",e||""),localStorage.setItem("user",JSON.stringify(n||""))}catch{}_(e)}function Q(){try{localStorage.removeItem("user"),localStorage.removeItem("token")}catch{}_("")}function Z(){try{const e=localStorage.getItem("user");return e?JSON.parse(e):{}}catch{return{}}}function W(){try{return localStorage.getItem("token")||""}catch{return""}}function _(e=null){const n=J("token");return n.value=e??n.value,n.value}const ee=P("auth",{state:()=>({user:null,token:""}),getters:{isAuthenticated:e=>!!(e.token||e.user&&e.user.id)},actions:{async hydrateFromStorage(){try{const e=W(),n=Z();e&&(this.token=e),n&&Object.keys(n).length&&(this.user=n)}catch{}},async login(e){const n=await S.post("auth/login",e,{toast:{showSuccess:!0,successMessage:"Logged in successfully"}}),t=n?.token||n?.access_token||"",o=n?.user||null;return this.token=t,this.user=o,K(t,o),n},async logout(){try{await S.post("auth/logout",null,{toast:{showSuccess:!1,showError:!1}})}catch{}this.token="",this.user=null,Q(),L("/auth/login")},async fetchMe(){const e=await S.get("auth/me",{toast:{showError:!1}});return e&&(this.user=e),e}},persist:!0});export{ee as u};
